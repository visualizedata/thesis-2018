<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <!-- Declare the character set of the document -->
        <meta charset="UTF-8">
         <!-- Support IE9-IE10 -->
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
          <!-- Set the viewport -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <!-- Javascripts -->
  <script src="https://d3js.org/d3.v3.min.js"></script>
  <script src="https://d3js.org/topojson.v1.min.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Archivo+Black|Lato" rel="stylesheet">
  
</head>

<style>
body {
  background: rgb(30, 30, 30);
  margin:0;
    position:fixed;
    top:0;
    right:0;
    bottom:0;
    left:0;
}

h1 {
  font-family: 'Lato', sans-serif;
  text-align: CENTER;
  font-size: 3.3em;
  color: #fff;
  padding-top: 1%;
  padding-bottom: 0%;
  margin: 1%;
}

h2 {
    font-family: 'Lato', sans-serif;
  text-align: CENTER;
  font-size: 2em;
  color: #fff;
  padding-top: 1%;
}

.description {
     font-family: 'Lato', sans-serif;
  text-align: Right;
  font-size: .5em;
  color: #fff;
  padding: 0;
  margin-right: 4%;
}

a:link {
   color: white;
}

img {
    max-width: 60%;
    height: auto;
}

#MEL {
    /*max-width: 9%;*/
    margin-top: 10%;
    height: auto;
}

#NYC {
     max-width: 90%;
    height: auto;
}

#LA {
     max-width: 86%;
    height: auto;
}

.bigtable {
  max-width: 100%;
  margin-left: auto;
  margin-right: auto;
}

.citykey {
   margin-top: 25px;
}

span {
    margin:0;
    position:fixed;
    top:0;
    right:0;
    bottom:0;
    left:0;
}


.city {
                fill: rgb(255, 204, 51);
                stroke: rgb(142, 142, 21);
                stroke-width: 0.4;
            }

#overlay {
    position: fixed; /* Sit on top of the page content */
    display: visible; /* Hidden by default */
    width: 80%; /* Full width (cover the whole page) */
    height: 80%; /* Full height (cover the whole page) */
    top: 12%; 
    left: 10%;
    right: 0;
    bottom: 0;
    background-color: rgba(15,15,15,.9); /* Black background with opacity */
    z-index: 2; /* Specify a stack order in case you're using a different order for other elements */
    cursor: pointer; /* Add a pointer on hover */
}
#example {
    padding-top: 3%;
    width: 25%;
    margin-left: 55%;
}

.explanationText {
    color: snow;
    text-align: left;
    margin-top: 5%;
    margin-left: 7%;
    width: 45%;
    padding: 0%;
    position: absolute;
}
            
p {
    font-family: 'Lato', sans-serif;
  text-align: left;
  font-size: 1.2em;
  color: #fff;
  padding-top: 1%;
  padding-bottom: 0%;
  margin: 1%;
}

button{
    margin-top: 3%;
    width: 8%;
    height: 4%;
}
</style>


  
<script type="text/javascript"> 

function on() {
    document.getElementById("overlay").style.display = "block";
}

function off() {
    document.getElementById("overlay").style.display = "none";
}
        var margin = 0,
            width = .2*(screen.availWidth),
            height = .3*(screen.availHeight);
    
    function draw(geo_data) {
          
        var svg = d3.selectAll("div").select("#content").select("svg")
            .attr("width", width + margin)
            .attr("height", height + margin);
        
        
        /////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////
        // DRAW GLOBE
        // Based on: http://bl.ocks.org/PatrickStotz/1f19b3e4cb848100ffd7
        /////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////
        
       var earthcolor = d3.rgb('rgb(10, 10, 10)');
       var countryfillcolor = d3.rgb("rgb(102,54,149)"); 
       var countrystrokecolor = d3.rgb("rgb(174, 114, 176)"); 

          var projection = d3.geo.orthographic()
                            .scale(85)
                            .translate([width*.5, height*.63])
                            .clipAngle(80) 
                          //.precision(0.2); 
          
         var pathproj = d3.geo.path().projection(projection);

        // drawing a sphere as landmass
        var g = svg.append("g");
            g.append("path")
               .datum({type: "Sphere"})
               .attr("class", "sphere")
               .attr("d", pathproj)
               .attr("fill", earthcolor);

        // drawing the worldmap
        var map = svg.append('g').selectAll('path')
                     .attr("class", "fill")
                     .data(geo_data.features)
                     .enter()
                     .append('path')
                     .attr('d', pathproj)
                     .style('fill', countryfillcolor) //country fill
                     .style('stroke', countrystrokecolor)
                     .style('stroke-width', .5)
                     .style('opacity',.8);
        
                /////////////////////////////////////////////////////////////////////////////////
                //draw, spin, and highlight the cities on the world
                function plot_points(data) {  
        
                    // Add city points to map!
                    // JSON object (instead of circles) for points allowed to be clipped at "backside" of earth:
                    svg.append('g')
                    .selectAll("path")
                        .data(data,function(d,i){ return d.id })    
                        .enter()
                        .append("path")
                        .classed("city", true)
                        .datum(function(d) {
                                return {
                                    type: "Point",
                                    coordinates: [d.lon, d.lat],
                                    class: "nohighlight" //My attempt at changing style through class..... not working....
                                }; })
                        
                        .attr("d", pathproj);

                // Control the radius of ALL circles!
                pathproj.pointRadius(function(d,i) { 
                    if (d.type =="Point") {
                        return d.class==="nohighlight" ? 4 : 20;
                    }
                });
      
               
                ////////////////////////////////////////////////////////////////////////////////////////////////////                         
                //        Spinning the globe:
                ////////////////////////////////////////////////////////////////////////////////////////////////////                         

                function spinning_globe(){

                        var time = Date.now();
                        var rotate = [0, 0];
                        var velocity = [.015, -0];


                        d3.timer(t => {

                            // get current time
                            var dt = Date.now() - time;
                                  //Define new projection over a rotating path
                                  projection.rotate([rotate[0] + velocity[0] * dt, rotate[1] + velocity[1] * dt]);

                                  //Add new projection to the map
                                  map.attr('d', pathproj)

                                  // Spin city locations: Method with JSON path element - only requires this line:
                                  svg.selectAll("path.city").attr("d", pathproj);

                                   }); // end timer spinning globe

                    }; // end spinning globe

                    spinning_globe();
                ////////////////////////////////////////////////////////////////////////////////////////////////////

            
            
                    ////////////////////////////////////////////////////////////////////////////////////////////////////                         
                    ////        HIGHLIGHTING the cities one by one:
                      var city_idx = 0; //data.id starts at 1        
  
                      //Every 300 msec: highlight a new city:
                      var city_play = setInterval(function() {
                        city_idx++;
                        // Control the radius of ALL circles!
                        pathproj.pointRadius(function(d,i) { 
                            
                            if (i < city_idx){
                              return 4
                            } else 
                              return 2
                        });
                          
                          // CHANGE CLASS? 
                          // CHANGE RADIUS?
                        	d3.selectAll(".city").attr("class", function(d, i){
                            if (i < city_idx){
                              return "city highlight"
                            } else 
                              return "city"
                          }).attr("d", pathproj)
                          
                          
                          var len =  d3.selectAll(".city").data().length;
                          console.log(city_idx, len)
                      //Stop when all cities are highlighted
                                if(city_idx>=len){
                                                clearInterval(city_play) //terminates calls to update function within setInterval function.
                                        };
                      }, 300); // end timer city play setInterval


                
                
                }; // end plot_points function
        
        ////////////////////////////////////////////////////////////////////////////////////////////////////
        // loading igem data 
      d3.csv("team_gpsTrue.csv", function(d) {
          d['id'] = +d['id'];
          d['lat'] = +d['lat'];
          d['lon'] = +d['lon'];
          return d;
        }, plot_points);
          
    }; // end of draw function
    ////////////////////////////////////////////////////////////////////////////////////////////////////
        
      </script>
  </head>
    
    
<!--<body>-->
<!--    <div id="content">-->
<!--        <svg></svg>-->
<!--    </div>-->
    
  

<body style="text-align:center;">
    <container id="overlay"><div class="explanation"><div><h2>Explanation of Project</h2></div><p class="explanationText">This project uses city quality of life indeces to help the user decide and choose the world's best city.  Fifteen cities were selected for this project based on three popular top ten lists: Conde Nast Traveler’s Top Ten Most Popular cities, Economist Intelligence Unit’s (EIU) Top Ten Livable Cities, and Pricewaterhouse Cooper’s Top Ten Cities of Opportunities. Once selected, eight indeces from Numbeo’s Quality of Life Quarterly Report and the United Nations were used to create the radar graph on the right.  To better understand and compare the data, the indeces were normalized from 1 to 100.  To enter the site, click on the enter button below.</p></div><div class=imageSq><img id="example" src="Lato/WorldCityExample.png"></div><button onclick="off()">Enter</button></container>
  
  
  <div class="background">
  
  <h1 class="textBack">The World's Best City</h1>
  <div class="bigtable"><table>
  <tr>
  <td><div class="citykey"><a href="indexAmsterdam.html"><img src="Lato/AmsterdamSphereLato.png" class="city" id="Amsterdam"></a></div></td>
  <td><div class="citykey" id="MEL"><a href="indexMelbourne.html"><img src="Lato/MelbourneSphereLato.png" class="city" id="Melbourne"></a></div></td>
  <td><div class="citykey"><a href="indexVancouver.html"><img src="Lato/VancouverSphereLato.png" class="city" id="Vancouver"></a></div></td>
  <td><div class="citykey"><a href="indexToronto.html"><img src="Lato/TorontoSphereLato.png" class="city" id="Toronto"></a></div></td>
  <td><div class="citykey"><a href="indexStockholm.html"><img src="Lato/StockholmSphereLato.png" class="city" id="Stockholm"></a></div></td>
  </tr>
  <tr>
  <td><div class="citykey"><a href="indexTokyo.html"><img src="Lato/TokyoSphereLato.png" class="city" id="Tokyo"></a></div></td>
  <td><div class="citykey" id="LA"><a href="indexLosAngeles.html"><img src="Lato/LosAngelesSphereLato.png" class="city" id="LosAngeles"></a></div></td>
 <td><div id="globe"><div id="content">
        <svg></svg>
    </div></div></td>
  <td><div class="citykey"><a href="indexParis.html"><img src="Lato/ParisSphereLato.png" class="city" id="Paris"></a></div></td>
  <td><div class="citykey"><a href="indexDubai.html"><img src="Lato/DubaiSphereLato.png" class="city" id="Dubai"></a></div></td>
  </tr>
  <tr>
  <td><div class="citykey"><a href="indexSingapore.html"><img src="Lato/SingaporeSphereLato.png" class="city" id="Singapore"></a></div></td>
  <td><div class="citykey" id="NYC"><a href="indexNewYork.html"><img src="Lato/NewYorkSphereLato.png" class="city" id="NewYork"></a></div></td>
  <td><div class="citykey"><a href="indexIstanbul.html"><img src="Lato/IstanbulSphereLato.png" class="city" id="Istanbul"></a></div></td>
  <td><div class="citykey"><a href="indexLondon.html"><img src="Lato/LondonSphereLato.png" class="city" id="London";></a></div></td>
  <td><div class="citykey"><a href="indexBangkok.html"><img src="Lato/BangkokSphereLato.png" class="city" id="Bangkok"></a></div></td>
  </tr>
  
  </table>
  </div>
  


</div>

<div class="description"><p>Index scores from <a href="https://numbeo.com">Numbeo.com</a>. <a href="https://github.com/hubideal/major_student_one"; style='color:snow;'>ReamMe</a></p></div>
 <div id="content">
        <svg></svg>
    </div>
<script type="text/javascript">
      d3.json("world_countries.json", function(error, geo_data) {
            draw(geo_data)
            });
</script>


</body>


